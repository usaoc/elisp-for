<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This manual documents For (version 1.3).

Copyright (C) 2022 Wing Hei Chan

This document is free documentation: you can redistribute it and/or
modify it under the terms of the GNU General Public License as published
by the Free Software Foundation, either version 3 of the License, or (at
your option) any later version.

This document is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License along
with this document.  If not, see https://www.gnu.org/licenses/. -->
<title>Introduction (For)</title>

<meta name="description" content="Introduction (For)">
<meta name="keywords" content="Introduction (For)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Concept-Index.html" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="index.html" rel="up" title="Top">
<link href="Basic-Concepts.html" rel="next" title="Basic Concepts">
<link href="index.html" rel="prev" title="Top">
<style type="text/css">
@import url("https://www.gnu.org/software/emacs/manual.css");
cite { font-style: italic; }
</style>

</head>

<body lang="en">
<div class="chapter" id="Introduction">
<div class="header">
<p>
Next: <a href="Basic-Concepts.html" accesskey="n" rel="next">Basic Concepts</a>, Previous: <a href="index.html" accesskey="p" rel="prev">For</a>, Up: <a href="index.html" accesskey="u" rel="up">For</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Introduction-1"></span><h2 class="chapter">1 Introduction</h2>
<span id="index-comparison-to-cl_002dloop"></span>
<span id="index-comparison-to-cl_002dloop-1"></span>
<span id="index-terminology"></span>
<span id="index-terminology-1"></span>
<span id="index-terminology-2"></span>
<span id="index-terminology-3"></span>
<p>Despite the same name as the imperative iteration construct in
<a href="https://doi.org/10.1093/comjnl/5.4.349">Algol</a>, this package is
inspired by the <a href="https://docs.racket-lang.org/reference/for.html">iteration</a> and
<a href="https://docs.racket-lang.org/reference/sequences.html">sequence</a>
forms<a id="DOCF1" href="#FOOT1"><sup>1</sup></a> in
<a href="https://racket-lang.org/">Racket</a>, which in turn is inspired by
<a href="https://srfi.schemers.org/srfi-42/srfi-42.html"><acronym title="Scheme Request for Implementation">SRFI</acronym> (Scheme Request for Implementation) 42</a>.  They are designed in such a way
that they can be both efficient and generic.  The distinctive feature of
them is that a sequence form can act either as an expander or a
generator (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Generators.html#Generators">(elisp)Generators</a>), and the former is used in the
iteration forms, that is, <code>for-fold</code> forms and derivatives.
Essentially, <code>for-fold</code> forms are equivalent to <code>named-let</code>
forms (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Local-Variables.html#Local-Variables">(elisp)Local Variables</a>), whose self-tail calls are
optimized to <code>while</code> loops (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Iteration.html#Iteration">(elisp)Iteration</a>)<a id="DOCF2" href="#FOOT2"><sup>2</sup></a>.  Therefore, the iteration forms can act as
Lispy<a id="DOCF3" href="#FOOT3"><sup>3</sup></a> and
functional<a id="DOCF4" href="#FOOT4"><sup>4</sup></a> replacements of the built-in iteration forms,
such as <code>cl-loop</code> (see <a data-manual="cl" href="https://www.gnu.org/software/emacs/manual/html_node/cl/Loop-Facility.html#Loop-Facility">(cl)Loop Facility</a>).
</p>
<p>A simple yet contrived <code>cl-loop</code> form:
</p>
<div class="example">
<pre class="example">(cl-loop for item in '(a 2 &quot;3&quot;)
         for number = (or (and (numberp item)
                               item)
                          (and (stringp item)
                               (string-to-number item)))
         if number collect number)
     &rArr; (2 3)
</pre></div>

<p>An equivalent <code>for-list</code> form with an <code>:if-let</code> special
clause:
</p>
<div class="example">
<pre class="example">(for-list ((item '(a 2 &quot;3&quot;))
           (:if-let
            (number (or (and (numberp item)
                             item)
                        (and (stringp item)
                             (string-to-number item)))))
           number))
     &rArr; (2 3)
</pre></div>

<p>An equivalent <code>for-list</code> form with a <code>:pcase</code> special clause:
</p>
<div class="example">
<pre class="example">(for-list ((item '(a 2 &quot;3&quot;))
           (:pcase item
                   (or (and (cl-type number)
                            number)
                       (and (cl-type string)
                            (app string-to-number number))))
           number))
     &rArr; (2 3)
</pre></div>

<p>All other iteration forms are derived from <code>for-fold</code> forms, which
in turn are equivalent to <code>named-let</code> forms.  In contrast, sequence
forms are defined through the definer <code>define-for-sequence</code>.  When
sequence forms are used in iteration clauses, they support aliases,
expanders, as well as dynamic dispatch; when used as function forms,
their function definitions are invoked, which are the corresponding
generators.
</p>
<p>Aliases and expanders are available in iteration clauses:
</p>
<div class="example">
<pre class="example">(for-list ((item (in-producer #'random))
           (5)
           item))
     &rArr; #&lt;a list of five pseudo-random integers&gt;
</pre></div>

<p>Generators are available in function forms:
</p>
<div class="example">
<pre class="example">(cl-loop for item iter-by (for-in-producer #'random)
         repeat 5 collect item)
     &rArr; #&lt;a list of five pseudo-random integers&gt;
</pre></div>

<p>The iteration forms use <code>pcase-let</code> (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Destructuring-with-pcase-Patterns.html#Destructuring-with-pcase-Patterns">(elisp)Destructuring with
<code>pcase</code> Patterns</a>) as the binding construct where it makes
sense.  This is useful for, but not only for destructuring.
</p>
<p>The destructuring capability of <code>cl-loop</code> forms:
</p>
<div class="example">
<pre class="example">(cl-loop for (number . string)
           in '((1 . &quot;1&quot;) (2 . &quot;b&quot;) (3 . &quot;3&quot;))
         if (eql number (string-to-number string))
           collect number)
     &rArr; (1 3)
</pre></div>

<p><code>for-list</code> forms use <code>pcase-let</code> forms:
</p>
<div class="example">
<pre class="example">(for-list ((`(,number . ,string)
            '((1 . &quot;1&quot;) (2 . &quot;b&quot;) (3 . &quot;3&quot;)))
           (:if (eql number (string-to-number string)))
           number))
     &rArr; (1 3)
</pre></div>

<p>All things considered, the iteration forms are both as efficient as
specialized iterations and as generic as the sequence functions
(see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Sequence-Functions.html#Sequence-Functions">(elisp)Sequence Functions</a>).  Moreover, they are more easily
extensible as compared to <code>cl-loop</code> forms.
</p>
</div>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5><a id="FOOT1" href="#DOCF1">(1)</a></h5>
<p>Following
<a href="https://schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-7.html">Scheme</a> as opposed to
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_e.htm">Common Lisp</a> and Emacs Lisp (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Forms.html#Forms">(elisp)Forms</a>), this manual refers
to an arbitrary Lisp object (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Lisp-Data-Types.html#Lisp-Data-Types">(elisp)Lisp Data Types</a>) as a
<em>form</em> and a form intended to be evaluated
(see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Evaluation.html#Evaluation">(elisp)Evaluation</a>) as an <em>expression</em>.  This means
expressions are a subset of forms.  Similarly, what Common Lisp calls a
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_s.htm"><em>subexpression</em></a> is called a <em>subform</em> in this manual.</p>
<h5><a id="FOOT2" href="#DOCF2">(2)</a></h5>
<p>In
fact, <code>for-fold</code> forms directly expand to <code>while</code> loops for
efficiency.  Moreover, the full recursive power of <code>named-let</code>
forms are not needed for sequence iterations.  Nonetheless, it is useful
to think of <code>for-fold</code> forms in terms of the equivalent
<code>named-let</code> forms.</p>
<h5><a id="FOOT3" href="#DOCF3">(3)</a></h5>
<p><em>Lispy</em> in the sense that they use Lisp-like
parenthesized syntax as opposed to Algol-like keyword-delimited syntax.
<a href="https://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node235.html">The
Common Lisp Loop Facility</a> has
<a href="https://doi.org/10.1145/154766.155373">its origin in Interlisp</a> and
has been
<a href="https://iterate.common-lisp.dev/doc/Don_0027t-Loop-Iterate.html">criticized for its Algol-like syntax</a>.</p>
<h5><a id="FOOT4" href="#DOCF4">(4)</a></h5>
<p><em>Functional</em> in the sense that they are
equivalent to applications of self-tail-recursive functions that
<a href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-11.html">transform local states</a>.</p>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Basic-Concepts.html">Basic Concepts</a>, Previous: <a href="index.html">For</a>, Up: <a href="index.html">For</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
