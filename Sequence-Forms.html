<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This manual documents For (version 1.2).

Copyright (C) 2022 Wing Hei Chan

This document is free documentation: you can redistribute it and/or
modify it under the terms of the GNU General Public License as published
by the Free Software Foundation, either version 3 of the License, or (at
your option) any later version.

This document is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License along
with this document.  If not, see https://www.gnu.org/licenses/. -->
<title>Sequence Forms (For)</title>

<meta name="description" content="Sequence Forms (For)">
<meta name="keywords" content="Sequence Forms (For)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Concept-Index.html" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Basic-Concepts.html" rel="up" title="Basic Concepts">
<link href="Multiple-Values.html" rel="next" title="Multiple Values">
<link href="For-Clauses.html" rel="prev" title="For Clauses">
<style type="text/css">
@import url("https://www.gnu.org/software/emacs/manual.css");
cite { font-style: italic; }
</style>

</head>

<body lang="en">
<div class="section" id="Sequence-Forms">
<div class="header">
<p>
Next: <a href="Multiple-Values.html" accesskey="n" rel="next">Multiple Values</a>, Previous: <a href="For-Clauses.html" accesskey="p" rel="prev">For Clauses</a>, Up: <a href="Basic-Concepts.html" accesskey="u" rel="up">Basic Concepts</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Sequence-Forms-1"></span><h3 class="section">2.2 Sequence Forms</h3>
<span id="index-sequence-form"></span>
<span id="index-sequence-form-1"></span>
<p>A <em>sequence form</em> represents an ordered collection of values, much
like an <em>iterator</em> (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Generators.html#Generators">(elisp)Generators</a>).  In fact, a
sequence form produces an iterator when evaluated as a function form
(see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Function-Forms.html#Function-Forms">(elisp)Function Forms</a>).  Nonetheless, iterators are relatively
expensive since they capture the states.  Rather than keeping the states
in another object, a sequence form can be directly expanded in an
iteration form when an <em>expander</em> is available.
</p>
<p>Produce an iterator that iterates over the list and iterate over
the values of it:
</p>
<div class="example">
<pre class="example">(let ((iterator (for-in-list '(1 2 3))))
  (for-vector ((item (for-in-iterator iterator))
               item)))
     &rArr; [1 2 3]
</pre></div>

<p>Directly iterate over the list:
</p>
<div class="example">
<pre class="example">(for-vector ((item (for-in-list '(1 2 3)))
             item))
     &rArr; [1 2 3]
</pre></div>

<span id="index-sequence-form-2"></span>
<p>For convenience, a sequence constructor can have <em>aliases</em> when used
in iteration clauses to avoid the need of shorthands
(see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Shorthands.html#Shorthands">(elisp)Shorthands</a>).
</p>
<p><code>for-in-list</code> and <code>for-in-range</code> have aliases:
</p>
<div class="example">
<pre class="example">(for-list ((item (in-list '(a b c)))
           (number (in-range 1 5 2))
           (cons item number)))
     &rArr; ((a . 1) (b . 3))
</pre></div>

<span id="index-error"></span>
<span id="index-sequence-form-3"></span>
<p><em>Dynamic dispatch</em> is available when an arbitrary expression is used
as a sequence form in iteration clauses.  The expression
<var>expression</var> is transformed to <code>(for-in-iterator (for-generator
<var>expression</var>))</code>, where <code>for-generator</code> is a generic function
(see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Generic-Functions.html#Generic-Functions">(elisp)Generic Functions</a>) that acts as a generator.  Moreover,
<code>for-unhandled-type</code> is <code>signal</code>ed (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Signaling-Errors.html#Signaling-Errors">(elisp)Signaling
Errors</a>) when the value of <var>expression</var> is unhandled.
</p>
<p>A <code>list</code> dispatched to the application of <code>for-in-list</code> to it:
</p>
<div class="example">
<pre class="example">(let ((list '(1 2 3)))
  (for-list ((item list)
             item)))
     &rArr; (1 2 3)
</pre></div>

<p>A <code>function</code> dispatched to itself:
</p>
<div class="example">
<pre class="example">(let ((iterator (for-in-list '(1 2 3))))
  (for-list ((item iterator)
             item)))
     &rArr; (1 2 3)
</pre></div>

<p><code>(record '#:some-type)</code> (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Special-Read-Syntax.html#Special-Read-Syntax">(elisp)Special Read Syntax</a> and
<a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Records.html#Records">(elisp)Records</a>) triggers <code>for-unhandled-type</code>:
</p>
<div class="example">
<pre class="example">(let ((some-object (record '#:some-type)))
  (for-list ((item some-object)
             item)))
     error&rarr; Unhandled type: #s(some-type)
</pre></div>

<span id="index-sequence-form-4"></span>
<p>Analogous to dynamic dispatch, certain <em>literal
objects</em><a id="DOCF9" href="#FOOT9"><sup>9</sup></a> are implicitly wrapped
in sequence forms when used in iteration clauses.  Currently, literal
lists, arrays (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Arrays.html#Arrays">(elisp)Arrays</a>), and integers (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Integer-Basics.html#Integer-Basics">(elisp)Integer
Basics</a>) are recognized.
</p>
<p>Recognized literal objects are implicitly wrapped in sequence forms:
</p>
<div class="example">
<pre class="example">(for-sum ((number1 '(3 4 5))
          (number2 [6 7 8])
          (number3 3)
          (* number1 number2 number3)))
     &rArr; 108
</pre></div>

</div>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5><a id="FOOT9" href="#DOCF9">(9)</a></h5>
<p>Following
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_l.htm">Common Lisp</a>, a self-evaluating (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Self_002dEvaluating-Forms.html#Self_002dEvaluating-Forms">(elisp)Self-Evaluating Forms</a>)
literal object can be either quoted or unquoted.</p>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Multiple-Values.html">Multiple Values</a>, Previous: <a href="For-Clauses.html">For Clauses</a>, Up: <a href="Basic-Concepts.html">Basic Concepts</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
