<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This manual documents For (version 1.1).

Copyright (C) 2022 Wing Hei Chan

This document is free documentation: you can redistribute it and/or
modify it under the terms of the GNU General Public License as published
by the Free Software Foundation, either version 3 of the License, or (at
your option) any later version.

This document is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License along
with this document.  If not, see https://www.gnu.org/licenses/. -->
<title>For Clauses (For)</title>

<meta name="description" content="For Clauses (For)">
<meta name="keywords" content="For Clauses (For)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Concept-Index.html" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Basic-Concepts.html" rel="up" title="Basic Concepts">
<link href="Sequence-Forms.html" rel="next" title="Sequence Forms">
<style type="text/css">
@import url("https://www.gnu.org/software/emacs/manual.css");
cite { font-style: italic; }
</style>

</head>

<body lang="en">
<div class="section" id="For-Clauses">
<div class="header">
<p>
Next: <a href="Sequence-Forms.html" accesskey="n" rel="next">Sequence Forms</a>, Up: <a href="Basic-Concepts.html" accesskey="u" rel="up">Basic Concepts</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="For-Clauses-1"></span><h3 class="section">2.1 For Clauses</h3>
<span id="index-for-clause"></span>
<span id="index-for-clause-1"></span>
<span id="index-terminology-4"></span>
<span id="index-terminology-5"></span>
<span id="index-terminology-6"></span>
<span id="index-terminology-7"></span>
<span id="index-terminology-8"></span>

<p>The expansion of an iteration form is driven by a series of <em>for
clauses</em>, classified into <em>iteration clauses</em> and <em>special
clauses</em>.  Iteration clauses decide the shapes of the expanded forms,
and special clauses wrap the partially expanded forms in some ways.  For
example, an iteration clause <code>(item '(a 2 &quot;3&quot;))</code> decides that
<code>item</code> is bound to each <code>car</code> of the literal list
(see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Quoting.html#Quoting">(elisp)Quoting</a>) sequence <code>(a 2 &quot;3&quot;)</code> and that the
iteration is stopped when it reaches the terminating empty list
(see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Box-Diagrams.html#Box-Diagrams">(elisp)Box Diagrams</a>)<a id="DOCF6" href="#FOOT6"><sup>6</sup></a>.  A special clause <code>(:if (numberp item))</code>
<em>following</em> the iteration clause decides that the partially
expanded form is skipped unless <code>item</code> is <code>numberp</code>
(see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Predicates-on-Numbers.html#Predicates-on-Numbers">(elisp)Predicates on Numbers</a>).
</p>
<p><code>sum</code> is only updated when <code>item</code> is <code>numberp</code>:
</p>
<div class="example">
<pre class="example">(for-fold ((sum 0))
    ((item '(a 2 &quot;3&quot;))
     (:if (numberp item))
     (+ item sum)))
     &rArr; 2
</pre></div>

<p>An equivalent <code>named-let</code> form:
</p>
<div class="example">
<pre class="example">(let ((sum 0))
  (named-let loop ((sum sum)
                   (tail '(a 2 &quot;3&quot;)))
    (if (null tail)
        sum
      (let ((item (car tail)))
        (loop (if (numberp item)
                  (+ item sum)
                sum)
              (cdr tail))))))

     &rArr; 2
</pre></div>

<p>Adjacent iteration clauses are considered parallel and thus iterated at
the same time.  When one of them ends, the iteration ends.  This gives
rise to the usefulness of infinite sequences.
</p>
<span id="index-convention"></span>
<span id="index-convention-1"></span>
<span id="index-convention-2"></span>

<p><code>(for-in-naturals [<var>start</var>])</code><a id="DOCF7" href="#FOOT7"><sup>7</sup></a> is an
infinite sequence:
</p>
<div class="example">
<pre class="example">(for-list ((natural (for-in-naturals))
           (item '(a b c))
           (cons natural item)))
     &rArr; ((0 . a) (1 . b) (2 . c))
</pre></div>

<p>As a consequence, special clauses also serve the purpose of delimiting
iteration clauses into groups.  A group of iteration clauses
<em>preceded</em> by another group is effectively nested.  Because the
nesting behavior is so commonly desired, implicitly nesting variants of
the iteration forms are provided.  They transform the for clauses by
separating each pair of adjacent iteration clauses with a vacuous
special clause.
</p>
<p><code>(item2 '(2 3 4))</code> nested by <code>(item1 '(1 2))</code> due to the
presence of <code>(:do)</code>:
</p>
<div class="example">
<pre class="example">(for-list ((item1 '(1 2))
           (:do)
           (item2 '(2 3 4))
           (cons item1 item2)))
     &rArr; ((1 . 2) (1 . 3) (1 . 4) (2 . 2) (2 . 3) (2 . 4))
</pre></div>

<p>An equivalent <code>for-list*</code> form:
</p>
<div class="example">
<pre class="example">(for-list* ((item1 '(1 2))
            (item2 '(2 3 4))
            (cons item1 item2)))
     &rArr; ((1 . 2) (1 . 3) (1 . 4) (2 . 2) (2 . 3) (2 . 4))
</pre></div>

<span id="index-terminology-9"></span>

<p>An iteration clause normally has the form <code>(<var>form</var>
<var>sequence</var>)</code> where the form of <var>form</var> is specified by the value
of <code>for-binder</code> and <var>sequence</var> is a sequence form.
Alternatively, it can have the form <code>(<var>sequence</var>)</code>, in which
case it is transformed to <code>(<var>identifier</var> <var>sequence</var>)</code> with
a generated identifier<a id="DOCF8" href="#FOOT8"><sup>8</sup></a> (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Creating-Symbols.html#Creating-Symbols">(elisp)Creating Symbols</a>) as <var>identifier</var>.  A
special clause has the form <code>(<var>keyword</var> . <var>subforms</var>)</code>
where <var>keyword</var> is one of the keywords (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Constant-Variables.html#Constant-Variables">(elisp)Constant
Variables</a>) accepted by the grammar and the form of
<var>subforms</var> is decided by <var>keyword</var>.
</p>
</div>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5><a id="FOOT5" href="#DOCF5">(5)</a></h5>
<p>Following
<a href="https://schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-4.html"><acronym title="Revised5 Report on the Algorithmic
Language Scheme">R<sup>5</sup>RS</acronym> (<cite>Revised<sup>5</sup> Report on the Algorithmic
Language Scheme</cite>)</a>, <em>an error</em> does not specify whether or when the error is
detected or reported.</p>
<h5><a id="FOOT6" href="#DOCF6">(6)</a></h5>
<p>In this manual, unless otherwise
specified, an object is a <em>list</em> if and only if it is a proper list.
Following
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/26_glo_p.htm">Common Lisp</a> and Emacs Lisp (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Cons-Cells.html#Cons-Cells">(elisp)Cons Cells</a>), a <em>proper
list</em> is either the empty list or a list terminated by the empty list.
It is an error for it to be any other structure produced by <code>cons</code>
(see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Building-Lists.html#Building-Lists">(elisp)Building Lists</a>, that is, a <em>circular list</em> or a
<em>dotted list</em>.)<a id="DOCF5" href="#FOOT5"><sup>5</sup></a>.</p>
<h5><a id="FOOT7" href="#DOCF7">(7)</a></h5>
<p>In this manual,
a metavariable is typeset as &lsquo;<samp><var>metavariable</var></samp>&rsquo;, an optional form
as &lsquo;<samp>[<var>optional-form</var>]</samp>&rsquo;, and a form repeated <em>once
or more</em> as &lsquo;<samp><var>repeated-form</var>&hellip;</samp>&rsquo;.  This is the same as
the Emacs Lisp Manual (see <a data-manual="elisp" href="https://www.gnu.org/software/emacs/manual/html_node/elisp/A-Sample-Function-Description.html#A-Sample-Function-Description">(elisp)A Sample Function Description</a>)
modulo the &lsquo;<samp><var>repeated-form</var>&hellip;</samp>&rsquo; convention.</p>
<h5><a id="FOOT8" href="#DOCF8">(8)</a></h5>
<p>In
<a href="http://www.r6rs.org/final/html/r6rs-lib/r6rs-lib-Z-H-13.html"><acronym title="Revised6 Report on the Algorithmic
Language Scheme">R<sup>6</sup>RS</acronym> (<cite>Revised<sup>6</sup> Report on the Algorithmic
Language Scheme</cite>)</a>, an <em>identifier</em> is roughly a syntax object of
non-constant symbol.  Emacs Lisp does not have the concept of syntax
object.  Nonetheless, this manual follows such usage of the
terminology.</p>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Sequence-Forms.html">Sequence Forms</a>, Up: <a href="Basic-Concepts.html">Basic Concepts</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
